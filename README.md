# Аутентифікація та авторизація.

Продовження створення REST API для роботи з колекцією контактів.

## Крок 1

- У коді створити модель користувача для таблиці users.
- Змінити модель контактів, щоб кожен користувач бачив тільки свої контакти. Для цього в модель контактів додати властивість

```
owner: {
   type: DataTypes.INTEGER,
   allowNull: false,
}
```

## Крок 2

**Реєстрація**

- Створити ендпоінт `/api/auth/register`
- Зробити валідацію всіх обов'язкових полів (email і password). При помилці валідації повернути Помилку валідації.
  У разі успішної валідації в моделі `User` створити користувача за даними, які пройшли валідацію. Для хешування паролів використовуй `bcrypt` або `bcryptjs`
  - Якщо пошта вже використовується кимось іншим, повернути Помилку `Conflict`.
  - В іншому випадку повернути Успішна відповідь.

**Логін**

- Створити ендпоінт `/api/auth/login`
- В моделі `User` знайти користувача за `email`.
- Зробити валідацію всіх обов'язкових полів (email і password). При помилці валідації повернути Помилку валідації.
  - В іншому випадку, порівняти пароль для знайденого користувача, якщо паролі збігаються створити токен, зберегти в поточному юзера і повернути Успішна відповідь.
  - Якщо пароль або імейл невірний, повернути Помилку `Unauthorized`.

## Крок 3

**Перевірка токена**

- Створити мідлвар для перевірки токена і додай його до всіх раутів, які повинні бути захищені.
  - Мідлвар бере токен з заголовків `Authorization`, перевіряє токен на валідність.
  - У випадку помилки повернути Помилку `Unauthorized`.
  - Якщо валідація пройшла успішно, отримати з токена `id` користувача. Знайти користувача в базі даних з цим `id`.
  - Якщо користувач існує і токен збігається з тим, що знаходиться в базі, записати його дані в `req.user` і викликати `next()`.
  - Якщо користувача з таким `id` НЕ існує або токени не збігаються, повернути Помилку `Unauthorized`

## Крок 4

**Логаут**

- Створити ендпоінт `/api/auth/logout`
- Додати в маршрут мідлвар перевірки токена.
- У моделі `User` знайти користувача за `id`.
- Якщо користувача не існує, повернути Помилку `Unauthorized`.
- В іншому випадку, видалити токен у поточного юзера і повернути Успішна відповідь.

## Крок 5

**Поточний користувач - отримати дані юзера по токені**

- Створити ендпоінт `/api/auth/current`
- Додати в раут мідлвар перевірки токена.
  - Якщо користувача не існує, повернути Помилку `Unauthorized`
  - В іншому випадку повернути Успішну відповідь
